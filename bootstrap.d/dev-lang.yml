sources:
  - name: python
    subdir: 'ports'
    git: 'https://github.com/python/cpython.git'
    tag: 'v3.10.4'
    version: '3.10.4'
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-libtool
      - host-pkg-config
      - host-autoconf-archive
    regenerate:
      - args: ['autoreconf', '-f', '-i']

tools:
  - name: host-python
    labels: [aarch64]
    architecture: noarch
    from_source: python
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

packages:
  - name: python
    labels: [aarch64]
    architecture: '@OPTION:arch@'
    from_source: python
    tools_required:
      - host-pkg-config
      - host-python
      - host-gcc
    pkgs_required:
      - mlibc
      - bzip2
      - gdbm
      - libexpat
      - libffi
      - libintl
      - libxcrypt
      - ncurses
      - openssl
      - readline
      - util-linux-libs
      - xz-utils
      - zlib
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--build=x86_64-linux-gnu'
        - '--prefix=/usr'
        - '--enable-shared'
        - '--with-sysroot=@SYSROOT_DIR@' # Set libtool's lt_sysroot.
        - '--with-system-ffi'
        - '--with-system-expat'
        - '--disable-ipv6'
        - '--without-ensurepip'
        environ:
          CONFIG_SITE: '@SOURCE_ROOT@/scripts/python-config-site'
          PKG_CONFIG_SYSROOT_DIR: '@BUILD_ROOT@/system-root'
          PKG_CONFIG_LIBDIR: '@BUILD_ROOT@/system-root/usr/lib/pkgconfig:@BUILD_ROOT@/system-root/usr/share/pkgconfig'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true
