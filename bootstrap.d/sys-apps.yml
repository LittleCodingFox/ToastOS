sources:
  - name: file
    subdir: ports
    git: 'https://github.com/file/file.git'
    tag: 'FILE5_42'
    version: '5.42'
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-libtool
    regenerate:
      - args: ['autoreconf', '-f', '-i']

  - name: util-linux
    subdir: ports
    git: 'https://git.kernel.org/pub/scm/utils/util-linux/util-linux.git'
    tag: 'v2.36.2'
    version: '2.36.2'
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-pkg-config
      - host-libtool
    regenerate:
      - args: ['./autogen.sh']

tools:
  - name: host-file
    architecture: noarch
    from_source: file
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - host-libtool
    revision: 2
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--prefix=@PREFIX@'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']

packages:
  - name: file
    from_source: file
    tools_required:
      - host-gcc
      - host-file
    pkgs_required:
      - mlibc
      - zlib
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-bzlib'
        - '--disable-xzlib'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: coreutils
    source:
      subdir: 'ports'
      git: 'https://git.savannah.gnu.org/git/coreutils.git'
      tag: 'v8.32'
      version: '8.32'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.11
      regenerate:
        - args: ['./bootstrap']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.11/share/automake-1.11/config.sub',
            '@THIS_SOURCE_DIR@/build-aux/']
    tools_required:
      # Bison 3.7 broke gnulib, work around it by building an older bison
      - host-bison
      - host-gcc
    pkgs_required:
      - mlibc
    revision: 2
    configure:
      # Huge hack: coreutils does not compile the build-machine binary make-prime-list
      # using the build-machine compiler. Hence, build and invoke the binary manually here.
      - args:
        - '@THIS_SOURCE_DIR@/configure'
      - args: ['make', 'src/make-prime-list']
      - args: |
          ./src/make-prime-list 5000 > @THIS_SOURCE_DIR@/src/primes.h
      - args: ['make', 'clean']
      # Now compile coreutils for the correct target.
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--enable-no-install-program=kill'
        - 'CFLAGS=-DSLOW_BUT_NO_HACKS -Wno-error'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: util-linux-libs
    labels: [aarch64]
    architecture: '@OPTION:arch@'
    from_source: util-linux
    tools_required:
      - host-gcc
      - host-autoconf-v2.69
      - host-automake-v1.15
    pkgs_required:
      - mlibc
      - readline
      - ncurses
      - zlib
      - libiconv
      - file
      - libxcrypt
    revision: 4
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--exec-prefix=/usr'
        - '--libdir=/usr/lib'
        - '--bindir=/usr/bin'
        - '--sbindir=/usr/sbin'
        - '--without-udev'
        - '--disable-nls'
        - '--disable-static'
        - '--without-python'
        - '--without-systemd'
        - '--without-systemdsystemunitdir'
        - '--disable-fdisks'
        - '--disable-mount'
        - '--disable-losetup'
        - '--disable-zramctl'
        - '--disable-fsck'
        - '--disable-partx'
        - '--disable-uuidd'
        - '--disable-wipefs'
        - '--disable-mountpoint'
        - '--disable-fallocate'
        - '--disable-unshare'
        - '--disable-nsenter'
        - '--disable-setpriv'
        - '--disable-hardlink'
        - '--disable-eject'
        - '--disable-agetty'
        - '--disable-plymouth_support'
        - '--disable-cramfs'
        - '--disable-bfs'
        - '--disable-minix'
        - '--disable-fdformat'
        - '--disable-hwclock'
        - '--disable-hwclock-cmos'
        - '--disable-hwclock-gplv3'
        - '--disable-mkfs'
        - '--disable-isosize'
        - '--disable-lsblk'
        - '--disable-lslogins'
        - '--disable-wdctl'
        - '--disable-swaplabel'
        - '--disable-mkswap'
        - '--disable-cal'
        - '--disable-logger'
        - '--disable-look'
        - '--disable-mcookie'
        - '--disable-namei'
        - '--disable-getopt'
        - '--disable-blockdev'
        - '--disable-lslocks'
        - '--disable-switch_root'
        - '--disable-pivot_root'
        - '--disable-flock'
        - '--disable-lsmem'
        - '--disable-chmem'
        - '--disable-ipcmk'
        - '--disable-ipcrm'
        - '--disable-ipcs'
        - '--disable-irqtop'
        - '--disable-lsirq'
        - '--disable-choom'
        - '--disable-renice'
        - '--disable-rfkill'
        - '--disable-setsid'
        - '--disable-ctrlaltdel'
        - '--disable-script'
        - '--disable-scriptreplay'
        - '--disable-scriptlive'
        - '--disable-col'
        - '--disable-colcrt'
        - '--disable-colrm'
        - '--disable-column'
        - '--disable-hexdump'
        - '--disable-rev'
        - '--disable-kill'
        - '--disable-last'
        - '--disable-utmpdump'
        - '--disable-mesg'
        - '--disable-raw'
        - '--disable-rename'
        - '--disable-chfn-chsh'
        - '--disable-login'
        - '--disable-nologin'
        - '--disable-sulogin'
        - '--disable-su'
        - '--disable-runuser'
        - '--disable-ul'
        - '--disable-more'
        - '--disable-setterm'
        - '--disable-schedutils'
        - '--disable-pg-bell'
        - '--disable-fstrim'
        - '--disable-swapon'
        - '--disable-lscpu'
        - '--disable-chcpu'
        - '--disable-blockdev'
        - '--disable-prlimit'
        - '--disable-lsipc'
        - '--disable-lsns'
        - '--disable-readprofile'
        - '--disable-dmesg'
        - '--disable-fincore'
        - '--disable-fsfreeze'
        - '--disable-blkdiscard'
        - '--disable-blkzone'
        - '--disable-ldattach'
        - '--disable-rtcwake'
        - '--disable-setarch'
        - '--disable-tunelp'
        - '--disable-wall'
        - '--disable-bash-completion'
        - '--without-cap-ng'
        - '--without-btrfs'
        - '--without-selinux'
        - '--without-audit'
        - '--enable-usrdir-path'
        - '--disable-makeinstall-chown'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/bin']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/sbin']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/share/bash-completion']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/share/man/man1']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/share/man/man8']

  - name: util-linux
    labels: [aarch64]
    architecture: '@OPTION:arch@'
    from_source: util-linux
    tools_required:
      - host-gcc
    pkgs_required:
      - mlibc
      - eudev
      - util-linux-libs
      - readline
      - ncurses
      - zlib
      - libiconv
      - file
      - libxcrypt
    revision: 5
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--exec-prefix=/usr'
        - '--libdir=/usr/lib'
        - '--bindir=/usr/bin'
        - '--sbindir=/usr/sbin'
        - '--with-udev'
        - '--disable-nls'
        - '--disable-static'
        - '--without-python'
        - '--without-systemd'
        - '--without-systemdsystemunitdir'
        - '--disable-partx'
        - '--disable-fallocate'
        - '--disable-unshare'
        - '--disable-nsenter'
        - '--disable-setpriv'
        - '--disable-eject'
        - '--disable-plymouth_support'
        - '--disable-fdformat'
        - '--disable-hwclock'
        - '--disable-hwclock-cmos'
        - '--disable-hwclock-gplv3'
        - '--disable-wdctl'
        - '--disable-logger'
        - '--disable-switch_root'
        - '--disable-pivot_root'
        - '--disable-chmem'
        - '--disable-ipcrm'
        - '--disable-ipcs'
        - '--disable-irqtop'
        - '--disable-rfkill'
        - '--disable-utmpdump'
        - '--disable-raw'
        - '--disable-chfn-chsh'
        - '--disable-login'
        - '--disable-nologin'
        - '--disable-sulogin'
        - '--disable-su'
        - '--disable-runuser'
        - '--disable-setterm'
        - '--disable-schedutils'
        - '--disable-pg-bell'
        - '--disable-fstrim'
        - '--disable-swapon'
        - '--disable-lscpu'
        - '--disable-chcpu'
        - '--disable-blockdev'
        - '--disable-prlimit'
        - '--disable-lsipc'
        - '--disable-lsns'
        - '--disable-readprofile'
        - '--disable-dmesg'
        - '--disable-fincore'
        - '--disable-fsfreeze'
        - '--disable-blkdiscard'
        - '--disable-blkzone'
        - '--disable-ldattach'
        - '--disable-rtcwake'
        - '--disable-setarch'
        - '--disable-tunelp'
        - '--enable-write'
        - '--without-cap-ng'
        - '--without-btrfs'
        - '--without-selinux'
        - '--without-audit'
        - '--enable-usrdir-path'
        - '--disable-makeinstall-chown'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/include']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/lib']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/share/man/man3']
      - args: ['rm', '-r', '@THIS_COLLECT_DIR@/usr/share/man/man5/terminal-colors.d.5']

  - name: which
    labels: [aarch64]
    architecture: '@OPTION:arch@'
    source:
      subdir: ports
      url: 'https://ftp.gnu.org/gnu/which/which-2.21.tar.gz'
      format: 'tar.gz'
      checksum: blake2b:355888b0dfe3e4e1679a8a9e1255a935fa48be220408abc441fae69fe0b26bd39e0544ed20e75497ed5bccaa75e788d9aec17007c668f15eaf6b1599faa131a0
      extract_path: 'which-2.21'
      version: '2.21'
    tools_required:
      - host-gcc
    pkgs_required:
      - mlibc
    revision: 3
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
